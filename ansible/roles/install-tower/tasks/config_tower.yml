- name: Install required packages 
  yum: 
     name: "{{item}}"
     state: latest 
  loop: 
    - python 
    - python-pip 
    - python-devel 
    - gcc
- name: Install tower-cli
  pip:
    name: ansible-tower-cli
    state: latest

- name: Configure the tower cli file
  template:
    src: tower_cli.j2
    dest: "~/.tower_cli.cfg"
    mode: 0600

- name: Download Licence file
  get_url:
    url: https://www.opentlc.com/download/ansible_bootcamp/tower/licenses/license.txt
    dest: /root/license.txt
- name: Append file
  lineinfile:
    path: /root/license.txt
    insertbefore: '"company_name.*"'
    line: '"eula_accepted" : "true",'

- name: Add the tower license 
  command: |
    tower-cli setting modify LICENSE @/root/license.txt

- name: Remove License file
  file:
   path: /root/license.txt
   state: absent

- name: inject aws read-only credentials into tower
  tower_credential:
     tower_host:         "tower1.{{guid}}.example.opentlc.com"
     tower_username:     "{{ tower_username }}"
     tower_password:     "{{ tower_password }}"
     name:               "AWS Readonly Credential"
     organization:       Default
     state:              present
     kind:               aws
     username:           "{{ readonly_aws_access_key }}"
     password:           "{{ readonly_aws_secret_key }}"
